<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>ABC-XYZ –ê–Ω–∞–ª–∏–∑</title>
</head>
<body>
    <h1>ABC-XYZ –ê–Ω–∞–ª–∏–∑</h1>
    <button onclick="startAnalysis()">–ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑</button>

    <p id="status"></p>
    <div id="download"></div>

    <script>
        let currentTaskId = null;
        let checkInterval = null;

        async function startAnalysis() {
            document.getElementById("status").innerText = "–ê–Ω–∞–ª–∏–∑ –∑–∞–ø—É—â–µ–Ω ‚è≥";
            document.getElementById("download").innerHTML = "";

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º POST –Ω–∞ /analyze
            let response = await fetch("/analyze", {method: "POST"});
            let data = await response.json();
            currentTaskId = data.task_id;

            // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–∞—Ç—É—Å–∞
            checkInterval = setInterval(checkStatus, 2000);
        }

        async function checkStatus() {
            let response = await fetch(`/status/${currentTaskId}`);
            let data = await response.json();

            if (data.ready) {
                clearInterval(checkInterval);
                document.getElementById("status").innerText = "–ì–æ—Ç–æ–≤–æ ‚úÖ";

                document.getElementById("download").innerHTML =
                    `<a href="/download/${currentTaskId}" download>
                        üì• –°–∫–∞—á–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç (Excel)
                     </a>`;
            }
        }
    </script>
</body>
</html>


